CREATE TABLE SALESMAN( SALESID NUMBER(5) PRIMARY KEY,
SNAME VARCHAR(20) ,
SCITY VARCHAR(15) ,
SCOMMISSION NUMBER(5));

INSERT INTO SALESMAN VALUES (1,'BHARATHESH','MANGLORE' , 10.5);
INSERT INTO SALESMAN VALUES (2,'BHARATH','MANGLORE' , 11);
INSERT INTO SALESMAN VALUES (3,'SHALESH','MANGLORE' , 12);
INSERT INTO SALESMAN VALUES (4,'GAMAN','BANGALORE' , 13.5);
INSERT INTO SALESMAN VALUES (5,'SINDOOR','MUMBAI' , 15);
INSERT INTO SALESMAN VALUES (1000,'HARISHA','KUNDAPUR' , 20);
SELECT * FROM SALESMAN ;

CREATE TABLE CUSTOMER( CID NUMBER(5) PRIMARY KEY ,
CNAME VARCHAR(15) ,
CCITY VARCHAR(20) ,
CGRADE VARCHAR(5) ,
SALESID REFERENCES SALESMAN ON DELETE CASCADE);

INSERT INTO CUSTOMER VALUES (1,'BHARATHESH','MANGALORE',3,1);
INSERT INTO CUSTOMER VALUES (2,'AKHIL','BANGALORE',3,1);
INSERT INTO CUSTOMER VALUES (3,'AJITH','MANGALORE',3,2);
INSERT INTO CUSTOMER VALUES (4,'ABHIJITH','BANGALORE',4,2);
INSERT INTO CUSTOMER VALUES (5,'PUSHPA','BANGALORE',3,5);
INSERT INTO CUSTOMER VALUES (6,'MAMTHA','BANGALORE',3,5);
INSERT INTO CUSTOMER VALUES (7,'SADHANA','MANGALORE',4,1000);
SELECT * FROM CUSTOMER;

CREATE TABLE ORDERS(
ORDERID NUMBER(5) PRIMARY KEY,
PURCHASE_AMT NUMBER(5) ,
ORD_DATE VARCHAR(10) ,
CID REFERENCES CUSTOMER ON DELETE CASCADE,
SALESID REFERENCES SALESMAN ON DELETE CASCADE
);

INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 1,'05-10-17',1500,1,1);
INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 2,'06-10-17',1600,1,2);
INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 3,'07-10-17',3500,1,1);
INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 4,'07-10-17',4600,2,2);
INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 5,'11-10-17',5200,2,3);
INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 6,'11-10-17',3000,3,3);
INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 7,'11-10-17',4000,3,3);
INSERT INTO ORDERS(ORDERID,ORD_DATE,PURCHASE_AMT,CID,SALESID) VALUES( 100,'22-11-17',4000,3,1000);
SELECT * FROM ORDERS;

-- 1.COUNT THE CUSTOMERS WITH GRADE ABOVE BANGLORE'S AVERAGE
SELECT COUNT(CID) FROM CUSTOMER 
WHERE CGRADE > (SELECT AVG(CGRADE) FROM CUSTOMER WHERE CCITY='BANGALORE');


-- 2. Find the name and numbers of all salesman who had more than one customer

SELECT SALESID , SNAME FROM SALESMAN 
WHERE SALESID IN( SELECT SALESID FROM CUSTOMER GROUP BY (SALESID) HAVING COUNT(*)>1);

--3. List all salesman and who hav/dont hav customers in their city(UNION)
SELECT SNAME,CNAME,SCITY FROM SALESMAN S, CUSTOMER C
WHERE S.SALESID=C.SALESID AND SCITY=CCITY 
UNION
SELECT SNAME,'Doesnt have customers',SCITY FROM SALESMAN S, CUSTOMER C
WHERE S.SALESID=C.SALESID AND SCITY!=CCITY;


--4. Create VIEW of salesmand with highest order of a day
CREATE VIEW MAX_DAY_SALE AS 
SELECT O.ORD_DATE , CID , SALESID , SUM(PURCHASE_AMT) AS MAX_SALE
FROM ORDERS O GROUP BY (SALESID,CID,ORD_DATE)
HAVING SUM(PURCHASE_AMT)=( SELECT MAX(SUM(PURCHASE_AMT)) FROM ORDERS 
WHERE ORD_DATE = O.ORD_DATE 
GROUP BY (SALESID,CID) );

 SELECT * FROM MAX_DAY_SALE;

--5. Delete salesman with ID=1000
DELETE FROM SALESMAN WHERE SALESID=1000;