DROP TABLE EMPLOYEE;
CREATE TABLE EMPLOYEE(
SSN INT PRIMARY KEY,
ENAME VARCHAR2(20),
ADDRESS VARCHAR2(20),
SEX VARCHAR(1) CHECK(SEX IN ('M','F')),
ESALARY NUMBER(6), 
SUPERSSN REFERENCES EMPLOYEE(SSN) ON DELETE CASCADE,
DNO NUMBER(3));

INSERT INTO EMPLOYEE VALUES(1,'Scott','Mangaluru','F',35000,1,NULL);
INSERT INTO EMPLOYEE VALUES(2,'Sahana','Mangaluru','F',35000,1,NULL);
INSERT INTO EMPLOYEE VALUES(3,'Sagar','Bengaluru','M',35000,1,NULL);
INSERT INTO EMPLOYEE VALUES(4,'Sagarik','Mangaluru','M',35000,1,NULL);
INSERT INTO EMPLOYEE VALUES(5,'Sajaan','Mysore','M',600000,1,NULL);
SELECT * FROM EMPLOYEE;

CREATE TABLE DEPARTMENT(
DNO NUMBER(5) PRIMARY KEY, 
DNAME VARCHAR2(10),
DMGRSSN REFERENCES EMPLOYEE ON DELETE CASCADE,
MGRSTARTDATE DATE);

ALTER TABLE EMPLOYEE
ADD CONSTRAINT FK
FOREIGN KEY(DNO) REFERENCES DEPARTMENT ON DELETE CASCADE;
DESC EMPLOYEE;

INSERT INTO DEPARTMENT VALUES(1,'CSE',1,'2-Nov-2007');
INSERT INTO DEPARTMENT VALUES(2,'IOT',2,'2-Nov-2007');
INSERT INTO DEPARTMENT VALUES(3,'Account',2,'2-Nov-2017');
INSERT INTO DEPARTMENT VALUES(4,'ISE',1,'2-Nov-2000');
INSERT INTO DEPARTMENT VALUES(5,'Finance',1,'3-Nov-2001');
SELECT * FROM DEPARTMENT;

UPDATE EMPLOYEE 
SET DNO=&DNO 
WHERE SSN=&SSN;

SELECT * FROM EMPLOYEE;

CREATE TABLE DLOCATION(
DNO REFERENCES DEPARTMENT,
DLOCATION VARCHAR2(10),
PRIMARY KEY(DNO,DLOCATION)); 

INSERT INTO dlocation VALUES(1,'Mangaluru');
INSERT INTO dlocation VALUES(1,'Mysore');
INSERT INTO dlocation VALUES(2,'Mangaluru');
INSERT INTO dlocation VALUES(3,'Bengaluru');
INSERT INTO dlocation VALUES(4,'Mangaluru');
INSERT INTO dlocation VALUES(5,'Mangaluru');
SELECT * FROM DLOCATION;

CREATE TABLE PROJECT(
PNO NUMBER(2) PRIMARY KEY,
PNAME VARCHAR2(20),
PLOCATION VARCHAR2(20),
DNO REFERENCES DEPARTMENT);

INSERT INTO project VALUES(1,'IOT','Managluru',1);
INSERT INTO project VALUES(2,'Data Mining','Managluru',1);
INSERT INTO project VALUES(3,'CC','Hubli',3);
INSERT INTO project VALUES(4,'Image processing','Managluru',4);
INSERT INTO project VALUES(5,'Research','Managluru',5);
SELECT * FROM PROJECT;

CREATE TABLE  WORKSON(
SSN REFERENCES EMPLOYEE ON DELETE CASCADE,
PNO REFERENCES PROJECT ON DELETE CASCADE,
WHOUR NUMBER(2));
INSERT INTO workson VALUES(1,1,4);
INSERT INTO workson VALUES(2,1,5);
INSERT INTO workson VALUES(3,2,4);
INSERT INTO workson VALUES(4,3,4);
INSERT INTO workson VALUES(5,5,4);

SELECT * FROM workson;

--1.PNO of all project in which 'SCOTT' is EMPLOYEE OR MANAGER
SELECT PNO FROM WORKSON
WHERE SSN IN ( SELECT SSN FROM EMPLOYEE WHERE ENAME='Scott');
/*UNION
SELECT PNO FROM PROJECT
WHERE DNO IN(
SELECT DNO FROM DEPARTMENT WHERE DMGRSSN IN
(SELECT SSN FROM EMPLOYEE WHERE ENAME='SCOTT')
)
;*/

--2. Employee on 'IOT' given 10% rise. (EMPLOYEE,WORKSON,PROJECT)
SELECT SSN,ENAME,ESALARY,1.1*ESALARY "UPDATED SAL" FROM EMPLOYEE
WHERE SSN IN(
SELECT SSN FROM WORKSON
WHERE PNO IN(
SELECT PNO FROM project WHERE PNAME='IOT'));

--3. Salary stats of ACCOUNTS Department;
SELECT SUM(ESALARY),AVG(ESALARY),MAX(ESALARY),MIN(ESALARY)
FROM EMPLOYEE E,DEPARTMENT D 
WHERE D.DNO=E.DNO AND DNAME='Account';

--4. SSN,ENAME who works on all projects controlled by DNO 5
--      (NOT EXIST)
SELECT SSN,ENAME FROM employee E 
WHERE NOT EXISTS(
(SELECT PNO FROM PROJECT WHERE DNO=5)
MINUS
(SELECT PNO FROM WORKSON W WHERE E.SSN=W.SSN)
);

--5. DNO,Number of employees(>5) and earning >600000
SELECT DNO,COUNT(*) "NO. EMPLOYEE" FROM EMPLOYEE 
WHERE ESALARY>60000 
GROUP BY DNO 
HAVING COUNT(*)>=5;

INSERT INTO EMPLOYEE VALUES(5,'SAJAAN','Mysore','M',600000,1,1);
INSERT INTO EMPLOYEE VALUES(6,'ARUN','Mysore','M',600000,1,1);
INSERT INTO EMPLOYEE VALUES(7,'VARUN','Mysore','M',600000,1,1);
INSERT INTO EMPLOYEE VALUES(8,'CHAYA','Mysore','M',600000,1,1);
INSERT INTO EMPLOYEE VALUES(9,'PREMA','Mysore','M',600000,1,1);
